pipeline {
    agent any
    
    stages {
        stage('Check Maven') {
            steps {
                script {
                    // Check if Maven is already installed
                    def mavenHome = tool 'Maven'
                    if (mavenHome == null) {
                        echo "Maven is not installed, installing now..."
                        // Install Maven tool using the Maven installer tool name
                        env.MAVEN_HOME = tool 'Maven'
                        // Add Maven bin directory to PATH
                        env.PATH += "${env.MAVEN_HOME}/bin"
                    } else {
                        echo "Maven is already installed at: $mavenHome"
                        // Set MAVEN_HOME environment variable
                        env.MAVEN_HOME = mavenHome
                        // Add Maven bin directory to PATH if needed
                        if (!env.PATH.contains("${env.MAVEN_HOME}/bin")) {
                            env.PATH += "${env.MAVEN_HOME}/bin"
                        }
                    }
                }
            }
        }
        
        stage('Checkout') {
            steps {
                // Checkout the source code from Git
                git url: 'https://github.com/santhoshbabu0411/springbootdemo.git'
            }
        }
        
        stage('Get Git ID') {
            steps {
                // Get the short Git commit ID
                script {
                    def get_id = sh(script: 'git rev-parse --short HEAD', returnStdout: true).trim()
                    env.GET_ID = get_id // Store the value in an environment variable
                }
            }
        }
        
        stage('Build') {
            steps {
                // Build the project using Maven
                withMaven(maven: 'Maven') {
                    sh 'mvn clean install'
                }
            }
        }
    }
}

