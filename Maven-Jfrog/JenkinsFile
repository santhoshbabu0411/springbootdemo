pipeline {
    agent any
    
    stages {
        stage('Pull GitHub Code') {
            steps {
                // Checkout code from GitHub repository
                git 'https://github.com/santhoshbabu0411/springbootdemo.git'
            }
        }
        
        stage('Check Maven Installation') {
            steps {
                // Check if Maven is installed
                script {
                    def mavenHome = tool 'Maven'
                    if (mavenHome == null) {
                        // Maven is not installed, so install it
                        echo 'Maven is not installed. Installing...'
                        def mvnHome = sh(script: 'mvn --version | grep "Maven home"', returnStdout: true).trim()
                        if (mvnHome) {
                            // Maven is found, set it up in Jenkins tool configuration
                            tool name: 'Maven', type: 'maven', installers: [
                                [installer: 'Apache Maven', id: 'apache-maven-3.8.4']
                            ]
                        } else {
                            // Maven is not found, exit the pipeline with failure
                            error 'Maven installation failed. Exiting pipeline.'
                        }
                    } else {
                        // Maven is already installed
                        echo "Maven is installed at $mavenHome"
                    }
                }
            }
        }
        
        stage('Build and Package') {
            steps {
                // Build the Java application using Maven
                script {
                    def mavenHome = tool 'Maven'
                    sh "${mavenHome}/bin/mvn clean package"
                }
            }
        }
    }
}

